def OC_TOKEN = 'UNKNOWN'

pipeline {
    agent any    
    environment {
        IMAGE_NAME = 'aceapp6'
        OC_USER = 'admin'
        OC_PASSWORD = 'admin'
        OC_URL = 'https://inquiry1.fyre.ibm.com:8443'
        OC_PROJECT = 'test'
        OC_REGISTRY = 'docker-registry.default.svc:5000'
    }    
    stages {
        stage('Initialization') {
           agent any
            steps {
                script {
                    sh '''
                        /usr/local/bin/oc login -u $OC_USER -p $OC_PASSWORD $OC_URL --insecure-skip-tls-verify
                        oc project $OC_PROJECT
                    '''
                    OC_TOKEN = sh (returnStdout: true, script: 'echo `oc whoami -t`')
                }
            }
        }
        stage('docker upload') {
            agent {
               label 'docker-agent'
            }
            steps {
                script {
                    sh '''
                        echo ${OC_TOKEN}
                        #docker login -p ${OC_TOKEN} -u admin $OC_REGISTRY
                    '''
                }
            }
        }
    }
}
